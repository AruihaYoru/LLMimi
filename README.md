# LLMimi (Mima Assembly Format) Specification for AI

LLMimiは、大規模言語モデル（LLM）が音楽を直感的に「設計・構築」するために開発された、テキストベースの音楽アセンブリ言語 **"Mima"** を使用する制作環境です。

## 1. コンセプト
- **Mima (Mimi-Assembly)**: 人間とAIが読み書きしやすい中間形式（10進数サポート、相対位置指定）。
- **Mimi (Raw Format)**: 再生エンジンが読み込む最終形式（完全16進数、絶対位置指定）。
- **コンパイル思想**: AIは計算ミスを避けるため、複雑な絶対時間の計算をせず、パーツ（Track）の組み合わせと相対的な指示に専念します。

---

## 2. 構文仕様

### A. トラック・コンテナ (`*.s`)
各楽器やパターンを定義する独立したパーツです。
- **フォーマット**: `Type, Pitch, Length, Start, [Volume], [Pan]`
- **各パラメータ**:
  1. **Type (音の種類)**: `00`:正弦波, `01`:三角波, `02`:矩形波, `03`:鋸歯状波, `04`:ノイズ
  2. **Pitch (音高)**: `0`〜`255` (MIDI規格準拠。C4=60)
  3. **Length (長さ)**: フレーム数指定
  4. **Start (開始地点)**: パーツ内での相対フレーム数 (通常は `0` から開始)
  5. **Volume (音量)**: `0`〜`255` (省略可)
  6. **Pan (定位)**: `0`(左) 〜 `128`(中央) 〜 `255`(右) (省略可)

### B. メイン・シーケンス (`main.s`)
定義したトラックをいつ、どの高さで鳴らすかを制御します。
- **フォーマット**: `TrackID, Start, PitchOffset, [Volume], [Pan]`
- **特別なキーワード**:
  - **`NEXT`**: 前のトラックが終了した直後のフレームを自動指定します。
  - **`+数値`**: 前のトラックの開始地点からの相対フレーム数を指定します。
- **PitchOffset**: トラック内の全ての音のピッチを一括でずらします（移調）。

---

## 3. 音楽理論の同期 (24fps設定時)

AIは以下の「フレーム数」を時間単位として使用してください。
- **BPM 120 (標準)**:
  - 1拍 (4分音符) = **12 frames**
  - 1小節 (4拍) = **48 frames**
  - 8分音符 = **6 frames** / 16分音符 = **3 frames**
- **BPM 140**:
  - 1拍 = **約10 frames** (10.28) / 1小節 = **41 frames**

---

## 4. AIのための作曲ガイドライン

### ステップ1: 楽器（パーツ）の定義
まずは再利用可能な短いパターンを作ります。
```text
# track 00.s (Basic Beat)
04, 0, 2, 0, 255, 128  # Kick
04, 0, 1, 6, 150, 150  # Hat
04, 0, 4, 12, 200, 128 # Snare
```

### ステップ2: 構造の組み立て
`main.s`でストーリーを作ります。計算ミスを避けるため、`NEXT`を活用してください。
```text
# main.s
00, 0, 0, 255, 128    # イントロ
00, NEXT, 0, 255, 128 # 繰り返し
01, 0, 0, 200, 128    # 0フレーム目からベースも重ねる
```

### ステップ3: 10進数の使用
AIは16進数の計算を間違える傾向があるため、**全ての数値入力は10進数で行うことを推奨します。** コンパイラが自動的に16進数へ変換します。

---

## 5. AIへのシステムプロンプト（推奨）

AIに作曲を依頼する際は、以下をプロンプトの冒頭にコピーしてください：

> 「あなたはMima Assembly形式の作曲家です。
> 1. まず各楽器のパターンを `track XX.s` として定義してください。
> 2. 次にそれらを組み合わせる `main.s` を作成してください。
> 3. 全ての数値は10進数を使用し、タイミングは 1beat=12, 1bar=48 フレーム（BPM120）を基準にしてください。
> 4. `NEXT` や `+数値` を活用して、正確なリズムを刻んでください。」

---

## 6. ファイル構成
- `index.html`: スタジオ画面
- `compiler.js`: Mima -> Mimi 変換エンジン
- `player.js`: Web Audio API 再生エンジン
- `main.js`: UI制御

---

### 開発者より
LLMimiは、AIが「音のパズル」を組み立てるための言語です。
複雑な計算はマシンに任せ、AIには「旋律の美しさ」と「構成の妙」に集中させてあげてください。# LLMimi
